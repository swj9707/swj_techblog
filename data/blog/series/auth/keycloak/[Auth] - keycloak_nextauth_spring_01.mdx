---
title: '[Auth] Keycloak, NextAuth, SpringBoot ì‚¼ë°•ì ë§ì¶”ê¸° - 01 : keycloak'
date: '2023-09-28T00:00:00.000Z'
tags: ['Keycloak', 'Authentication', 'Next.js', 'SpringBoot']
draft: false
layout: PostBanner
images: ['/static/images/blog/01_keycloak/keycloak-nextjs-spring-series-thumbnail.png']
summary: Keycloak, NextAuth, SpringBoot ì—°ë™ ê°€ì´ë“œ, Keycloak Setup ë°©ë²•
---

í•´ë‹¹ í¬ìŠ¤íŒ…ì€ [velog ê¸°ìˆ ë¸”ë¡œê·¸](https://velog.io/@sierra9707/Authentication-NextAuth-Keycloak-Spring-Boot-%EC%82%BC%EB%B0%95%EC%9E%90-%EB%A7%9E%EC%B6%94%EA%B8%B0-Intro) ì—ì„œë„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
í¬ìŠ¤íŒ… ì—°ì¬ ì¢…ë£Œê¹Œì§€ í•´ë‹¹ ë¸”ë¡œê·¸ì— ë™ì‹œ ì—°ì¬ ì˜ˆì •ì…ë‹ˆë‹¤.

# ğŸ˜€ Intro

ì§€ë‚œ í¬ìŠ¤íŒ…ì—ì„œ NextAuthì™€ Keycloak ì— ëŒ€í•´ ì†Œê°œí–ˆìŠµë‹ˆë‹¤. ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” Keycloakì„ ì…‹ì—…í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª… í•´ ë³¼ê¹Œ í•©ë‹ˆë‹¤.

keycloak ì´ ê°€ì§€ëŠ” ì´ì ì´ ë¬´ì—‡ì¼ê¹Œìš”? ì œ ìƒê°ì—” ì„œë¹„ìŠ¤ì˜ í™•ì¥ì´ ìš©ì´í•˜ë‹¤ëŠ” ê²ƒ ì…ë‹ˆë‹¤.
ì¼ë°˜ì ìœ¼ë¡œ Spring ì„ ì²˜ìŒ ê³µë¶€í•˜ëŠ” ì…ì¥ì—ì„œ JWT í† í°ì— ëŒ€í•´ ê³µë¶€í•˜ê²Œ ëœë‹¤ë©´, êµ­ë£° ì²˜ëŸ¼ ì“°ì´ëŠ” ì½”ë“œë“¤ì´ ìˆìŠµë‹ˆë‹¤. ë°”ë¡œ ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë“¤ì…ë‹ˆë‹¤.

```java
  public Key getSigningkey(String secretKey) {
        return Keys.hmacShaKeyFor(secretKey.getBytes(StandardCharsets.UTF_8));
    }

    public Claims extractAllClaims(String jwtToken) {
        return Jwts.parserBuilder()
            .setSigningKey(getSigningkey(secretKey))
            .build()
            .parseClaimsJws(jwtToken)
            .getBody();
    }

    public Authentication getAuthentication(String token) {
        UserDetails userDetails = userDetailsService.loadUserByUsername(getUserEmail(token));
        return new UsernamePasswordAuthenticationToken(userDetails, "",
            userDetails.getAuthorities());
    }


    public String createToken(String userEmail, Long validTime) {
        Claims claims = Jwts.claims().setSubject(userEmail);
        claims.put("userEmail", userEmail);
        return Jwts.builder()
            .setClaims(claims)
            .setIssuedAt(new Date(System.currentTimeMillis()))
            .setExpiration(new Date(System.currentTimeMillis() + validTime))
            .signWith(getSigningkey(secretKey), signatureAlgorithm)
            .compact();
    }

    public String getUserEmail(String token) {
        return extractAllClaims(token).get("userEmail", String.class);
    }

    public String resolveToken(HttpServletRequest request) {
        String token = request.getHeader("Authorization");
        if (token != null) {
            return token.substring("Bearer ".length());
        } else {
            return "";
        }
    }

    public ResCode validateToken(String jwtToken) {
        try {
            Jws<Claims> claims = Jwts.parserBuilder().setSigningKey(getSigningkey(secretKey))
                .build().parseClaimsJws(jwtToken);
            if (!claims.getBody().getExpiration().before(new Date())) {
                return ResCode.OK;
            } else {
                return ResCode.EXPIRED_TOKEN;
            }
        } catch (SecurityException e) {
            return ResCode.TOKEN_INVALID_SIGNATURE;
        } catch (
            MalformedJwtException e) {
            return ResCode.TOKEN_MALFORMED;
        } catch (
            UnsupportedJwtException e) {
            return ResCode.TOKEN_UNSUPPORTED;
        } catch (
            ExpiredJwtException | IllegalArgumentException e) {
            return ResCode.EXPIRED_TOKEN;
        }
    }

    public Long getExpiration(String jwtToken) {
        Date expiration = Jwts.parserBuilder().setSigningKey(getSigningkey(secretKey)).build()
            .parseClaimsJws(jwtToken).getBody().getExpiration();
        long now = System.currentTimeMillis();
        return expiration.getTime() - now;
    }
```

ì œê°€ ì˜ˆì „ì— ì‚¬ìš©í•˜ë˜ JwtUtil ì½”ë“œë¥¼ ê·¸ëƒ¥ ê·¸ëŒ€ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤ë§Œ, ì•„ë§ˆ ë¹„ìŠ·í•œ ì½”ë“œë¥¼ ë§ì´ ì‚¬ìš©í•  ê²ƒì´ë¼ ìƒê°í•©ë‹ˆë‹¤.

ì •ë§ ë‹¨ìˆœí•œ í˜•íƒœì˜ JWT í† í°ì„ ë°œê¸‰ ë° ê²€ì¦í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.

```java
public String createToken(String userEmail, Long validTime) {
    Claims claims = Jwts.claims().setSubject(userEmail);
    claims.put("userEmail", userEmail);
    return Jwts.builder()
        .setClaims(claims)
        .setIssuedAt(new Date(System.currentTimeMillis()))
        .setExpiration(new Date(System.currentTimeMillis() + validTime))
        .signWith(getSigningkey(secretKey), signatureAlgorithm)
        .compact();
}
```

claim ë°ì´í„°ì—ëŠ” ì˜¤ì§ ìœ ì €ì˜ ì´ë©”ì¼ë§Œ ì¡´ì¬í•©ë‹ˆë‹¤.
ì²˜ìŒì— ì´ëŸ° ì½”ë“œë¥¼ ì‘ì„±í•  ë•, Claim ë°ì´í„°ì— ë§ì€ ë°ì´í„°ê°€ í•„ìš” í•  ì´ìœ ê°€ ìˆì„ê¹Œ ë¼ëŠ” ê³ ë¯¼ì„ í–ˆìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ ê°œë°œì„ í•˜ë‹¤ë³´ë©´ ì„œë¹„ìŠ¤ì˜ ê·œëª¨ê°€ ìƒê°í–ˆë˜ ê²ƒ ë³´ë‹¤ ì»¤ì§ˆ ìˆ˜ë„ ìˆê³ , ë¹„ì¦ˆë‹ˆìŠ¤ì˜ ê·œëª¨ê°€ ì»¤ì§€ê²Œ ëœë‹¤ë©´, ë˜ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë¥¼ ê¸°ì¡´ ì„œë¹„ìŠ¤ì— í™•ì¥ ì‹œì¼œì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ êµ¬ì¡°ê°€ ë‹¤ì–‘í•œ ì˜ê²¬ì´ ìˆì§€ë§Œ, ì„œë¹„ìŠ¤ì˜ ê·œëª¨ê°€ ì•„ì£¼ í° ìƒí™©ì´ê³  ìš”êµ¬ì‚¬í•­ì´ ëŠ˜ì–´ë‚œ ìƒí™©ì´ë¼ë©´ ê³ ë ¤í•´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ì¦‰ í™•ì¥ì„ ê³ ë ¤í•´ì•¼ í•˜ëŠ” ìƒí™©ì—ì„œ ìœ„ì˜ ì½”ë“œê°€ ê³¼ì—° ë„ì›€ì´ ë  ì§€? ìƒê° í•´ë³´ë©´ ì œ ìƒê°ì€ ì•„ë‹ˆë‹¤! ì…ë‹ˆë‹¤.

ìœ„ì˜ ì½”ë“œì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œì ì´ ì¡´ì¬í•©ë‹ˆë‹¤.

- claim ë°ì´í„°ì— ë³€ê²½ì´ ìƒê¸´ë‹¤ë©´(ìì£¼ ì¼ì–´ë‚˜ëŠ” ì¼ì€ ì•„ë‹ˆê² ì§€ë§Œ) ì„œë²„ë¥¼ ë‹¤ì‹œ ë¹Œë“œí•´ì•¼ í•œë‹¤.
- ë§Œì•½ OAuth2 ë¥¼ ë„ì…í•˜ê²Œ ëœë‹¤ë©´ ê·¸ì— ë§ëŠ” ê²€ì¦ ë¡œì§ì„ ë”°ë¡œ ë¶„ë¦¬ ë° ì‘ì„±ì„ í•´ì•¼í•œë‹¤. ì„œë²„ë¥¼ ë‹¤ì‹œ ë¹Œë“œí•´ì•¼ í•œë‹¤.
- ë§Œì•½ ë‹¤ë¥¸ ì¸ì¦ ë°©ì‹ì„ ì¶”ê°€í•˜ê²Œ ëœë‹¤ë©´ ìƒë‹¹íˆ ë¨¸ë¦¬ê°€ ì•„íŒŒì§„ë‹¤.

ëª¨ë†€ë¦¬ì‹ ì•„í‚¤í…ì³ë´ê³  í•´ë„ ë³´ì•ˆ ì„œë²„ì™€ ë¦¬ì†ŒìŠ¤ ì„œë²„(API ì„œë²„)ë¥¼ ë¶„ë¦¬í•˜ëŠ” ê²½ìš°ëŠ” ìì£¼ ìˆìŠµë‹ˆë‹¤. ì•„ë¬´ë¦¬ ì¸ì¦ì„œë²„ë¥¼ ë”°ë¡œ ë¶„ë¦¬í•´ì„œ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤ í•˜ë”ë¼ë„ ê²°êµ­ ê³µí†µì ì¸ ë¬¸ì œëŠ” ë¹Œë“œë¥¼ ë‹¤ì‹œí•´ì•¼ í•  ë¿ë§Œ ì•„ë‹ˆë¼, ìƒˆë¡œ ë„ì…í•œ ì¸ì¦ ë°©ì‹ì˜ ê²€ì¦ì´ ì–´ë ¤ì›Œì§„ë‹¤ëŠ” ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.

ë¬¼ë¡  ì €ë¥¼ ì œì™¸í•œ ì½”ë”©ì„ ì•„ì£¼ ì˜í•˜ëŠ” ë‹¤ë¥¸ ê°œë°œìë“¤ì€ ì´ê²Œ ë¬¸ì œê°€ ì•„ë‹ˆë¼ê³  ìƒê°í•  ìˆ˜ ìˆê² ì§€ë§Œ, ì¤‘ìš”í•œ ê±´ ë¹„ì¦ˆë‹ˆìŠ¤ ìƒì—ì„œ ê¸°í•œì„ ë§ì¶”ëŠ” ê²ƒì´ë¼ ìƒê°í•©ë‹ˆë‹¤.

ê°œë°œìë“¤ ë¼ë¦¬ ì¬ë¯¸ì‚¼ì•„ ì¸ì¦ì„œë²„ë¥¼ ë°±ì§€ë¶€í„° ëê¹Œì§€ ê°œë°œí•˜ëŠ” ê²ƒì€ ì •ë§ ì¢‹ì€ ê²½í—˜ì´ ë  ìˆ˜ ìˆì§€ë§Œ, ê°œë°œìë“¤ì˜ ë‚­ë§Œì„ ì¶©ì¡± ì‹œì¼œì£¼ê¸°ì—” í˜„ì‹¤ì˜ ì‹œê°„ì€ ê·¸ë ‡ê²Œ ë„‰ë„‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ê·¸ ë¿ë§Œì´ ì•„ë‹™ë‹ˆë‹¤. ì„œë¹„ìŠ¤ë¥¼ ê°œë°œ ë° ìš´ì˜í•˜ë‹¤ë³´ë©´ ìš´ì˜ì— í•„ìš”í•œ ì„œë¹„ìŠ¤(Grafana, Kibana ë“±)ë¥¼ ë°°ì¹˜í•´ì•¼ í•˜ëŠ” ê²½ìš°ë„ ìˆìŠµë‹ˆë‹¤. ì´ëŸ° ê²½ìš°ì— í•´ë‹¹ ì„œë¹„ìŠ¤ë§ˆë‹¤ ê³„ì •ì„ ë”°ë¡œ ìƒì„±í•˜ê²Œ ëœë‹¤ë©´ ìš´ì˜í•˜ëŠ” ì…ì¥ì—ì„œë„ ìƒë‹¹íˆ í˜ë“  ë¬¸ì œê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì¦‰ í‚¤í´ë¡ì„ ì‚¬ìš©í•œë‹¤ë©´, ì‹œê°„ê³¼ í™•ì¥ì„±ì— ì´ì ì´ ìƒê¸°ê²Œ ë©ë‹ˆë‹¤. ìƒˆë¡œìš´ ì¸ì¦ ì„œë¹„ìŠ¤ë¥¼ í™•ì¥í•˜ê±°ë‚˜ ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ë¥¼ ë¡ ì¹­í•˜ê²Œ ëœë‹¤ëŸ¬ë„ ì„œë¹„ìŠ¤ ë§ˆë‹¤ ë³´ì•ˆ ì„œë²„ë¥¼ ë‘˜ í•„ìš”ë„ ì—†ê³ , Redis ë“±ì— í† í° ì •ë³´ë¥¼ ì €ì¥ í•  í•„ìš”ë„ ë”ì´ìƒ ì—†ìŠµë‹ˆë‹¤.

ì‚¬ì‹¤ ìœ„ì˜ ì½”ë“œë¡œ ì‘ì—…í•œ ì„œë²„ëŠ” í† í° ì •ë³´ë¥¼ ì €ì¥í•´ì•¼ í•  Redis ì„œë²„ê°€ ë”°ë¡œ í•„ìš”í•˜ê²Œ ë˜ëŠ”ë° ì„œë¹„ìŠ¤ê°€ í™•ì¥ ë˜ê²Œ ëœë‹¤ë©´, ê²°êµ­ Redisì—ë„ ê²°í•©ë„ê°€ ìƒê¸°ê²Œ ë©ë‹ˆë‹¤. í‚¤í´ë¡ì„ í†µí•´ ì´ëŸ¬í•œ ê²°í•©ë„ë¥¼ ë‚®ì¶œ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

# ğŸ”‘ Keycloakì˜ ì£¼ìš” ê¸°ëŠ¥

keycloakì´ë€ ê·¸ëŸ¼ ë„ëŒ€ì²´ ë­˜ê¹Œìš”? keycloakì€ SSO ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•´ì¤„ ìˆ˜ ìˆëŠ” ì˜¤í”ˆì†ŒìŠ¤ì…ë‹ˆë‹¤.

Github : [](https://github.com/keycloak/keycloak)
ê³µì‹ ì‚¬ì´íŠ¸ : [](https://www.keycloak.org/)

ì—¬ê¸°ì„œ SSOë€, Single Sign Onìœ¼ë¡œ í•œ ë²ˆì˜ ë¡œê·¸ì¸ìœ¼ë¡œ ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ë¥¼ ëª¨ë‘ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê¸°ìˆ ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

ìš°ë¦¬ê°€ ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í•  ë•Œ ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒì„ êµ¬í˜„í•˜ëŠ” ë° ë§ì€ ì• ë¥¼ ì¨ì•¼ í•©ë‹ˆë‹¤. ë³´ì•ˆê³¼ ê´€ë ¨ ëœ ë¬¸ì œê³  íšŒì›ê°€ì…ì„ í†µí•´ ìœ ì € ì •ë³´ë¥¼ ì €ì¥í•´ì•¼ í•˜ëŠ” ìƒí™©ì—ì„œëŠ” ê°œì¸ ì •ë³´ê¸° ë•Œë¬¸ì— ë²• ì ì¸ ë¬¸ì œê¹Œì§€ ê³ ë¯¼í•´ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ëª¨ë“  ë¬¸ì œê°€ ì–´ì°Œ í•´ê²°ëœë‹¤ í•˜ë”ë¼ë„ ìœ ì € ì…ì¥ì—ì„œëŠ” ë‹¤ì–‘í•˜ê²Œ í™•ì¥ ëœ ì„œë¹„ìŠ¤ ë§ˆë‹¤ ìƒˆë¡œìš´ ê³„ì •ì„ ë§Œë“œëŠ” ê²ƒì´ ë¶ˆí¸í•˜ê²Œ ëŠê»´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë§Œì•½ì— ì‡¼í•‘ëª° ì„œë¹„ìŠ¤ë¥¼ ìš´ì˜ì¤‘ì¸ ìƒí™©ì—ì„œ OTT ì„œë¹„ìŠ¤ë¥¼ í•˜ë‚˜ ë” ì¶”ê°€í–ˆì„ ë•Œ, ë‘ ì„œë¹„ìŠ¤ê°„ì— ë‹¤ë¥¸ ê³„ì •ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤ë©´, ìœ ì € ì…ì¥ì—ì„œë„, ìš´ì˜ì§„ ì…ì¥ì—ì„œë„ ê³¨ì¹˜ì•„í”ˆ ì¼ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê°œì¸ì •ë³´ ë°ì´í„°ê°€ ë¶„ì‚°ë˜ì„œ ì²˜ë¦¬ë˜ì–´ì•¼ í•˜ëŠ” ë“± ìƒê°ë§Œ í•´ë„ ë¨¸ë¦¬ì•„í”ˆ ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

keycloakì„ ì‚¬ìš©í•˜ê²Œ ëœë‹¤ë©´, ì´ëŸ¬í•œ ë¬¸ì œì—ì„œ ì´ì ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ë‚˜ì˜ keycloak ì„œë²„ê°€ ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ì˜ ì¸ì¦ì„ ì±…ì„ ì ¸ ì¤„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

# ğŸ˜ƒ Keycloak ì„¤ì • ë²•

## ğŸ³ Docker

ì§ì ‘ ì„¤ì¹˜í•˜ëŠ” ë°©ë²•ë„ ìˆì§€ë§Œ, ë¡œì»¬ì—ì„œ ì‰½ê²Œ ì…‹ì—…í•˜ë ¤ë©´ ì•„ë¬´ë˜ë„ Dockerë¥¼ ì‚¬ìš©í•˜ëŠ” ê²Œ í¸ë¦¬í•©ë‹ˆë‹¤. ê³µì‹ ë¬¸ì„œì—ëŠ” Dockerë¥¼ í†µí•´ Keycloakì„ ì‰½ê²Œ ì…‹ì—…í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ê°€ì´ë“œê°€ ì˜ ì‘ì„± ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

ê¸€ì„ ì“°ëŠ” ì‹œì ì—ì„œ ìµœì‹  ë²„ì „ì€ 21.1.1ì…ë‹ˆë‹¤.

[](https://www.keycloak.org/getting-started/getting-started-docker)

Docker Compose ë¥¼ í†µí•´ Keycloak ì„ ì…‹ì—…í•˜ë ¤ë©´ ì•„ë˜ì™€ ê°™ì´ ì…‹ì—…í•˜ë©´ ë©ë‹ˆë‹¤.

```yaml
version: '3.8'
services:
  keycloak-database:
    image: postgres:latest
    container_name: keycloak_db
    expose:
      - '5433'
    ports:
      - '5433:5433'
    volumes:
      - ./db/keycloakDB:/var/lib/postgresql/data
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: 'keycloak'
    env_file:
      - .env
    healthcheck:
      test: ['CMD-SHELL', 'pg_isready -U postgres']
      interval: 10s
      timeout: 5s
      retries: 5
    command:
      - '-p 5433'
    networks:
      keycloak-nw:
        aliases:
          - 'keycloak_db'
  keycloak:
    image: quay.io/keycloak/keycloak
    container_name: keycloak
    environment:
      KEYCLOAK_ADMIN: ${KEYCLOAK_USER}
      KEYCLOAK_ADMIN_PASSWORD: ${KEYCLOAK_PASSWORD}
      KC_DB: postgres
      KC_DB_URL: jdbc:postgresql://keycloak-database:5433/keycloak
      KC_DB_USERNAME: ${POSTGRES_USER}
      KC_DB_PASSWORD: ${POSTGRES_PASSWORD}
      KC_HEALTH_ENABLED: true
      KC_METRICS_ENABLED: true
    ports:
      - '8080:8080'
    command: start-dev
    healthcheck:
      test: 'curl -f http://localhost:8080/admin || exit 1'
    depends_on:
      keycloak-database:
        condition: service_started
    networks:
      keycloak-nw:
        aliases:
          - 'keycloak'

networks:
  keycloak-nw:
    driver: bridge
```

DBë¥¼ ë”°ë¡œ ì…‹ì—… í•´ ì£¼ëŠ” ì´ìœ ëŠ”, Keycloak ì„œë²„ëŠ” ì™¸ë¶€ DBì™€ ì—°ë™í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì‚¬ì‹¤ Keycloak ìì²´ì ìœ¼ë¡œ H2 ë°ì´í„°ë² ì´ìŠ¤ê°€ ë°°ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤ë§Œ, Docker ë¡œ ì„¤ì¹˜í•œ ì´ìƒ, ì»¨í…Œì´ë„ˆê°€ ìì£¼ ë‚´ë ¤ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì¦‰ ë°ì´í„°ë¥¼ ì–´ë”˜ê°€ì—ëŠ” ë°±ì—…í•´ì•¼ í•˜ëŠ”ë°, ì•„ë¬´ë¦¬ keycloak ë‚´ë¶€ì— ìˆëŠ” ë°ì´í„°ë¥¼ volumns ì†ì„±ì„ í†µí•´ ë°±ì—…í•œë‹¤ í•˜ë”ë¼ë„ DBì— ì§ì ‘ ë°±ì—…í•˜ëŠ” ê²ƒê³¼ ë‹¤ë¥´ê²Œ H2 ë°ì´í„°ë² ì´ìŠ¤ ìƒì—ì„œ ë°ì´í„° ì†ì‹¤ì´ ì¼ì–´ë‚  ìˆ˜ ìˆëŠ” ìš°ë ¤ê°€ ìˆìŠµë‹ˆë‹¤.

ê·¸ëŸ¬ë¯€ë¡œ ë”°ë¡œ Keycloak ìš© DBë¥¼ ë”°ë¡œ ë‘ê±°ë‚˜, ê¸°ì¡´ì— ì‚¬ìš©í•˜ê³  ìˆëŠ” DBì— ìŠ¤í‚¤ë§ˆë¥¼ í•˜ë‚˜ ì ìš© í•´ì„œ í…ŒìŠ¤íŠ¸ í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.

\***\*ì œê°€ ì²˜ìŒì— Keycloak ì„ ì‚¬ìš©í•  ë•Œ, H2 ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•´ ì‹ ê²½ì“°ì§€ ì•Šê³  volumn ì†ì„±ìœ¼ë¡œ ëŒ€ì¶© ë°±ì—…í•˜ë‹¤ í¬ê²Œ ê³ í†µì„ ë°›ì•˜ì—ˆìŠµë‹ˆë‹¤.\*\***

## Realm & Client

![](/static/images/blog/01_keycloak/01/keycloak_main.png)

Keycloak ì€ Admin UI ê°€ ì¡´ì¬í•©ë‹ˆë‹¤. Admin UIë¥¼ í†µí•´ ì‰½ê²Œ Realm, Client ì •ë³´ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Keycloak ì„ ì‚¬ìš©í•˜ê¸° ì „ì— ë¨¼ì € Realmê³¼ Clientì— ëŒ€í•´ ì´í•´í•´ì•¼ í•©ë‹ˆë‹¤.

Realm ì€ ì‰½ê²Œ ì–˜ê¸°í•˜ë©´ ì„œë¹„ìŠ¤ ë²”ìœ„ë¼ê³  ìƒê°í•˜ì‹œë©´ ë©ë‹ˆë‹¤. Realm ë‚´ì— ì¡´ì¬í•˜ëŠ” ì„œë¹„ìŠ¤ë“¤ì€ Clientë¼ê³  ë¶€ë¦…ë‹ˆë‹¤.

Realm ë‹¨ìœ„ë¡œ ì¸ì¦, ê¶Œí•œ ë¶€ì—¬ê°€ ì ìš©ì´ ë˜ê³  ClientëŠ” ê·¸ëŸ¬í•œ ì¸ì¦, ê¶Œí•œ ë¶€ì—¬ í–‰ìœ„ë¥¼ ìˆ˜í–‰ í•  ì• í”Œë¦¬ì¼€ì´ì…˜ë“¤ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

![](/static/images/blog/01_keycloak/01/keycloak_realm_main.png)

ì˜ˆë¥¼ ë“¤ì–´ ì‡¼í•‘ëª° Realm ì´ ì¡´ì¬í•œë‹¤ë©´, ì•ì„œ ì–¸ê¸‰í–ˆë˜ ì‡¼í•‘ëª° Client, OTT Client ë“±ì´ ì¡´ì¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê° Clientë“¤ì€ ê°™ì€ Realm ì— ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— í•˜ë‚˜ì˜ ê³„ì •ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ’ Realm Role ì„¤ì •

Realm ì´ë¼ëŠ” ë‹¨ìœ„ì— ìœ ì €ë“¤ì´ ìƒì„±ë˜ê³  ë‚˜ë©´ í•´ë‹¹ ë‹¨ìœ„ì— ëŒ€í•œ ìœ ì €ì˜ Roleì„ ì„¤ì • í•´ ì¤„ ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

Realm ì— ì°¸ì—¬í•˜ê³  ìˆëŠ” ìœ ì €ë“¤ì€ ì¼ë°˜ ìœ ì €ì¼ ìˆ˜ë„ ìˆì§€ë§Œ, ì–´ë“œë¯¼ì¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ê·¸ëŸ¬ë¯€ë¡œ ìœ ì €ì— ë”°ë¼ ê¶Œí•œì„ ë‹¤ë¥´ê²Œ ë¶€ì—¬ í•´ ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. ì‰½ê²Œ ìƒê°í•˜ë©´, ì‡¼í•‘ëª° Realm ì´ ìˆìœ¼ë©´ í•´ë‹¹ Realm ì— ì°¸ì—¬í•˜ëŠ” ìœ ì €ëŠ” ì¼ë°˜ ìœ ì €, ê´€ë¦¬ì, ìœ ì§€ë³´ìˆ˜ ì—”ì§€ë‹ˆì–´, ê°œë°œì ë“± ë‹¤ì–‘í•œ Roleì„ ê°€ì§ˆ ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.

![](/static/images/blog/01_keycloak/01/realm_roles.png)

ê°„ëµí•˜ê²Œ ë‚˜ëˆ ì„œ Userì™€ Admin ìœ¼ë¡œ ë‚˜ëˆ  ë³´ê² ìŠµë‹ˆë‹¤.

![](/static/images/blog/01_keycloak/01/realm_roles_ex.png)

Roleì„ ìƒì„±í•˜ê¸°ë§Œ í•´ì„œ ëì´ ë‚˜ëŠ” ê±´ ì•„ë‹™ë‹ˆë‹¤. ê° Roleë§ˆë‹¤ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. User Roleì„ ê°€ì§„ ìœ ì €ê°€ Realm ì˜ ê´€ë¦¬ ê¶Œí•œì„ ê°€ì ¸ì„œëŠ” ì•ˆë˜ê² ì£ . ë°˜ëŒ€ë¡œ Admin Roleì„ ê°€ì§„ ìœ ì €ê°€ ê´€ë¦¬ ê¶Œí•œì´ ë”°ë¡œ ì—†ë‹¤ë©´, User Roleê³¼ ì°¨ì´ê°€ ì—†ì–´ì„œ ì•„ë¬´ëŸ° ì˜ë¯¸ê°€ ì—†ëŠ” Role ì •ë³´ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì¶”ê°€í•  ìˆ˜ ìˆëŠ” Roleì˜ ë²”ìœ„ëŠ” Realm ë²”ìœ„ì™€ Client ë²”ìœ„(ë‹¤ìŒ ë‹¨ë½ì—ì„œ ë” ìì„¸í•˜ê²Œ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.)ë¡œ ë‚˜ë‰©ë‹ˆë‹¤. Realm ë²”ìœ„ëŠ” ë§ ê·¸ëŒ€ë¡œ ì „ì²´ Realm ë‚´ì—ì„œì˜ Roleì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì¢€ ë” ìƒì„¸í•œ Roleì€ Client Roleì—ì„œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ë©´, ìš´ì˜ìì™€ ì„ ì„ ìš´ì˜ìë¼ëŠ” Roleì´ ìˆì„ ë•Œ ìœ ì €ë¥¼ ìƒˆë¡œ ë“±ë¡í•˜ëŠ” ê¶Œí•œì€ ì„ ì„ ìš´ì˜ìì—ê²Œë§Œ ìˆë‹¤ê³  ê°€ì • í•´ ë³´ê² ìŠµë‹ˆë‹¤. ìœ ì €ë¥¼ ìƒˆë¡œ ë“±ë¡í•˜ëŠ” ê¶Œí•œ ê·¸ ìì²´ëŠ” Realm Roleì´ ê°€ì§ˆ ìˆ˜ ìˆëŠ” í•˜ë‚˜ì˜ Roleì´ ë©ë‹ˆë‹¤. ì „ì²´ ì„œë¹„ìŠ¤ì˜ ë²”ìœ„ë‚´ì—ì„œì˜ í° Roleì¸ Realm Roleì€ ì•ì„œ ë§ì”€ë“œë¦° ìœ ì €, ìš´ì˜ì ë“±ì´ì§€ë§Œ ê·¸ Roleì´ client ë§ˆë‹¤ ê°€ì§ˆ ìˆ˜ ìˆëŠ” Role, ì¦‰ ì„¸ë¶€ Roleì€ Client Roleì„ í†µí•´ ì„ ì–¸ í•©ë‹ˆë‹¤.

## Client ì •ë³´ ì„¤ì • ë° Role ì„¤ì •

![](/static/images/blog/01_keycloak/01/client_info.png)

Client Roleì€ ì„œë¹„ìŠ¤ ë‚´ì˜ Roleì„ ì˜ë¯¸í•©ë‹ˆë‹¤. Realm ë‚´ì˜ í° ë²”ìœ„ì˜ Roleì´ ì•„ë‹Œ ì„¸ë¶€ì ì¸ Client ë‚´ì˜ Roleì€ ì—¬ê¸°ì„œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì§ì ‘ ì„ ì–¸í•œ Client ë§ê³  ì‚¬ì§„ì— ì–¸ê¸‰ë˜ì–´ìˆë“¯, admin-cli, realm-management ë“± Realm ì˜ì—­ì—ì„œ ì–´ë“œë¯¼ ì—­í• ì„ í•  ìˆ˜ ìˆëŠ” client ë“¤ì´ ì¡´ì¬í•©ë‹ˆë‹¤.

í•´ë‹¹ client ë‚´ì— ì„ ì–¸ ë˜ì–´ìˆëŠ” Roleë“¤ì€ ì‹¤ì œ Realm Role ì—ì„œ ì„¸ë¶€ì ìœ¼ë¡œ í• ë‹¹ì‹œì¼œì¤„ ìˆ˜ ìˆëŠ” Roleì…ë‹ˆë‹¤.

ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ì„œ ë” ìì„¸íˆ ì–¸ê¸‰ ë“œë¦¬ê² ì§€ë§Œ, Spring Bootì™€ Keycloak Admin Clientë¥¼ ì—°ê²°í•  ë•Œ í•´ë‹¹ Roleë“¤ì„ ì£¼ì˜ê¹Šê²Œ ì‹ ê²½ì¨ì•¼ í•©ë‹ˆë‹¤.

í˜„ì¬ê¹Œì§€ì˜ í¬ìŠ¤íŒ…ì—ì„œ Keycloakì„ ì²˜ìŒ ë³´ê²Œ ë˜ì—ˆë‹¤ë©´, Realm Roleê³¼ Client Roleì˜ ì°¨ì´ ì •ë„ ì´í•´í•˜ì…¨ìœ¼ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤.

![](/static/images/blog/01_keycloak/01/client_roles_ex.png)

![](/static/images/blog/01_keycloak/01/client_roles_assign_ex.png)

ìœ„ ì‚¬ì§„ì€ Client Role ìƒì„± ì˜ˆì‹œ, í•´ë‹¹ Roleì— Client, Realm Roleì„ í• ë‹¹í•˜ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤.

ì¢€ ë” ìì„¸í•œ ì´ì•¼ê¸°ëŠ” ë‹¤ìŒ í¬ìŠ¤íŒ…, ìŠ¤í”„ë§ ë¶€íŠ¸ì™€ì˜ ì—°ë™ì—ì„œ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.

![](/static/images/blog/01_keycloak/01/client_roles_ex2.png)

Client Roleì€ ì„œë¹„ìŠ¤ ë‚´ì˜ Roleì„ ì˜ë¯¸í•©ë‹ˆë‹¤. Realm ë‚´ì˜ í° ë²”ìœ„ì˜ Roleì´ ì•„ë‹Œ ì„¸ë¶€ì ì¸ Client ë‚´ì˜ Roleì€ ì—¬ê¸°ì„œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì§ì ‘ ì„ ì–¸í•œ Client ë§ê³  ì‚¬ì§„ì— ì–¸ê¸‰ë˜ì–´ìˆë“¯, admin-cli, realm-management ë“± Realm ì˜ì—­ì—ì„œ ì–´ë“œë¯¼ ì—­í• ì„ í•  ìˆ˜ ìˆëŠ” client ë“¤ì´ ì¡´ì¬í•©ë‹ˆë‹¤.

í•´ë‹¹ client ë‚´ì— ì„ ì–¸ ë˜ì–´ìˆëŠ” Roleë“¤ì€ ì‹¤ì œ Realm Role ì—ì„œ ì„¸ë¶€ì ìœ¼ë¡œ í• ë‹¹ì‹œì¼œì¤„ ìˆ˜ ìˆëŠ” Roleì…ë‹ˆë‹¤.
â€‹
ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ì„œ ë” ìì„¸íˆ ì–¸ê¸‰ ë“œë¦¬ê² ì§€ë§Œ, Spring Bootì™€ Keycloak Admin Clientë¥¼ ì—°ê²°í•  ë•Œ í•´ë‹¹ Roleë“¤ì„ ì£¼ì˜ê¹Šê²Œ ì‹ ê²½ì¨ì•¼ í•©ë‹ˆë‹¤.
â€‹
í˜„ì¬ê¹Œì§€ì˜ í¬ìŠ¤íŒ…ì—ì„œ Keycloakì„ ì²˜ìŒ ë³´ê²Œ ë˜ì—ˆë‹¤ë©´, Realm Roleê³¼ Client Roleì˜ ì°¨ì´ ì •ë„ ì´í•´í•˜ì…¨ìœ¼ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤.

![](/static/images/blog/01_keycloak/01/client_role_ex3.png)

## OpenID Connect API

ì—¬ê¸°ê¹Œì§€ ì§„í–‰í•˜ì…¨ë‹¤ë©´, ìƒˆë¡œìš´ í´ë¼ì´ì–¸íŠ¸ë¥¼ ìƒì„± í–ˆì„ ê²ƒì…ë‹ˆë‹¤. ì•„ì§ ìƒì„±í•˜ì§€ ì•Šì•˜ë‹¤ë©´ ë‹¤ìŒì˜ ê°€ì´ë“œë¥¼ ë”°ë¥´ì‹œë©´ ë©ë‹ˆë‹¤.

![](/static/images/blog/01_keycloak/01/client_ex.png)

ë¨¼ì € Client Typeì„ OpenID Connectë¡œ ì„¤ì • í•´ ì¤ë‹ˆë‹¤. ë‹¤ë¥¸ ì„ íƒì§€ë¡œ SAML ì´ ìˆëŠ”ë°, SAML ì¸ì¦ì€ ì¡°ê¸ˆ ë” ë³´ì•ˆì— ì‹ ê²½ ì“´ ë°©ì‹ìœ¼ë¡œ ì´í•´í•˜ê³  ìˆìŠµë‹ˆë‹¤.

[](https://www.okta.com/kr/identity-101/whats-the-difference-between-oauth-openid-connect-and-saml)

ìœ„ì˜ ë§í¬ì—ì„œ ì°¨ì´ì ì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ë‘˜ ë‹¤ Single Sign On ì„ ìœ„í•´ í•„ìš”í•œ ê¸°ìˆ ì´ì§€ë§Œ, ê°€ì¥ ê²°ì •ì ì¸ ì°¨ì´ë¡œëŠ” JWTë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì´ëƒ ì•„ë‹ˆëƒì˜€ìŠµë‹ˆë‹¤. í”íˆ OAuth ì¸ì¦ì„ êµ¬í˜„í•˜ê²Œ ëœë‹¤ë©´ JWTí† í°ì„ ì‚¬ìš©í•˜ê²Œ ë˜ì§€ë§Œ SAML ì—ì„œëŠ” XML SAML í˜•ì‹ì„ í†µí•´ ì¸ì¦ì´ ì§„í–‰ë©ë‹ˆë‹¤.

![](/static/images/blog/01_keycloak/01/client_ex2.png)

ê¸°ì´ˆ ì„¤ì •ì´ ëë‚¬ë‹¤ë©´, Client Authentication, Authorization ì˜µì…˜ì„ ì¼œ ì¤ë‹ˆë‹¤. í•´ë‹¹ ì˜µì…˜ë“¤ì€ Service Accounts Roles ì˜µì…˜ì„ í™œì„±í™” ì‹œí‚¤ê¸° ìœ„í•´ í•„ìš”í•©ë‹ˆë‹¤.

ì—¬ê¸°ê¹Œì§€ ì§„í–‰í•˜ì…¨ë‹¤ë©´, Client í˜ì´ì§€ì—ì„œ Credentials íƒ­ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Credentials íƒ­ìœ¼ë¡œ ì§„ì…í•˜ê²Œ ëœë‹¤ë©´ Client Secret ë°ì´í„°ë¥¼ ì „ë‹¬ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![](/static/images/blog/01_keycloak/01/client_ex3.png)

í•´ë‹¹ ë°ì´í„°ëŠ” OpenID Connect API ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ í•„ìš”í•©ë‹ˆë‹¤. Create Client ì´ë¯¸ì§€ë¥¼ í™•ì¸ í•´ ë³´ì…¨ê² ì§€ë§Œ, Client Authentication, Authorization ì˜µì…˜ì„ í™œì„±í™” í•˜ì˜€ê¸° ë•Œë¬¸ì— í—ˆê°€ë°›ì§€ ì•Šì€ ìœ ì €ê°€ Realm ì— ì¸ì¦ì„ í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.

í•´ë‹¹ ì˜µì…˜ì„ í†µí•´ Service Account ê°€ í™œì„±í™” ë©ë‹ˆë‹¤. ì—¬ê¸°ì„œ Service Accoutë€, í•´ë‹¹ Clientì— ì ‘ê·¼ ê¶Œí•œì„ ê°€ì§„, í•´ë‹¹ Client ë¥¼ ëŒ€í‘œí•´ì„œ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆëŠ” ìœ ì € í‚¤ë¼ê³  ìƒê° í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

![](/static/images/blog/01_keycloak/01/postman_ex.png)

ì´ì œ ì—¬ê¸°ê¹Œì§€ ì˜¤ì…¨ë‹¤ë©´, POST MAN í˜¹ì€ Curl ì„ í†µí•´ OpenID Endpoint ì˜ ì •ë³´ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
curl -X GET http://localhost:8080/realms/{realmName}/well-known/openid-configuration
```

í•´ë‹¹ Endpoint ë“¤ì„ í†µí•´ Keycloak ì—ì„œ ìœ ì € ì •ë³´ë¥¼ ë°›ì•„ì˜¤ê±°ë‚˜ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ APIëŠ” ê°€ì´ë“œ ìš©ë„ë¼ íŠ¹ë³„íˆ ê¶Œí•œì´ í•„ìš”ì—†ìŠµë‹ˆë‹¤.

ì—¬ê¸°ê¹Œì§€ ì…‹ì—…í–ˆë‹¤ë©´ keycloak ì˜ ê¸°ì´ˆ ì…‹ì—…ì€ ì–´ëŠì •ë„ ì •ë¦¬ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´í›„ë¡œì˜ ì…‹ì—…ì€ ì‚¬ì‹¤ ì„œë¹„ìŠ¤ì˜ ê°œë°œ ë°©í–¥ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤ë§Œ, ë§ˆì§€ë§‰ìœ¼ë¡œ í† í° ì •ë³´ ìƒì„± ë° ë¦¬í”„ë ˆì‰¬ í† í° ë°œê¸‰ê¹Œì§€ ê°€ì´ë“œë¥¼ ë“œë¦¬ê³  ë§ˆë¬´ë¦¬ í•˜ê² ìŠµë‹ˆë‹¤.

## Token API

> http://localhost:8080/realms/{realmName}/protocol/openid-connect/token

ìœ„ì˜ ì•¤ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ ìœ ì €ì˜ í† í° ì •ë³´ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¦‰ Authentication ì„ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìš°ì„  í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ì•„ê¹Œ ìƒì„±í–ˆë˜ Realm ì— ìœ ì €ë¥¼ í•œëª… ì¶”ê°€ í•´ ë³´ê² ìŠµë‹ˆë‹¤.

![](/static/images/blog/01_keycloak/01/user_ex.png)

ê·¸ í›„ ì•„ê¹Œ ìƒì„±í–ˆë˜ clientì˜ credential codeë¥¼ í†µí•´ Token ì •ë³´ë¥¼ ë°›ì•„ ë³´ê² ìŠµë‹ˆë‹¤. ìœ„ì˜ ì—”ë“œí¬ì¸íŠ¸ì— `POST` API ë¥¼ ì „ë‹¬í•˜ë˜, íŒŒë¼ë¯¸í„°ë“¤ì€ x-www-form-urlencoded í˜•íƒœë¡œ ì „ë‹¬ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

![](/static/images/blog/01_keycloak/01/postman_ex2.png)

![](/static/images/blog/01_keycloak/01/postman_ex3.png)

í† í°ì´ ì–¸ì œ ë§Œë£Œë˜ëŠ” ì§€, refresh token ë°ì´í„°ëŠ” ì–´ë–»ê²Œ êµ¬ì„±ë˜ì–´ìˆëŠ”ì§€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í† í° ë§Œë£Œì‹œê°„, ë¦¬í”„ë ˆì‹œ í† í° ë§Œë£Œ ì‹œê°„ ì—¬ë¶€, claim ë°ì´í„° ë“±ì€ keycloak ë‚´ì—ì„œ ë³€ê²½ ê°€ëŠ¥í•©ë‹ˆë‹¤.

ë°˜ëŒ€ë¡œ Refresh Token ì€ ì•„ë˜ì™€ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” Refresh Token ì„ íŒŒë¼ë¯¸í„°ë¡œ ìƒˆë¡œìš´ í† í°ì„ ë°œê¸‰ë°›ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤.

![](/static/images/blog/01_keycloak/01/postman_ex4.png)

grant_typeì„ refresh_tokenìœ¼ë¡œ ë³€ê²½í•˜ê³  ë°œê¸‰ ë°›ì•˜ë˜ refresh_token ì„ ì „ë‹¬í•˜ë©´ ìƒˆë¡œìš´ í† í°ì´ ìƒì„±ë˜ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

# ğŸ‘ Outro

ì§€ê¸ˆê¹Œì§€ ê°„ë‹¨í•œ Keycloak ì…‹ì—… ë²• ë° OpenID connect API ë¥¼ í†µí•´ Token ì •ë³´ë¥¼ ë°›ì•„ì˜¤ëŠ” ë²•ì„ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤.

ì‹¤ì œë¡œ ì´ëŸ¬í•œ ë°©ë²•ë³´ë‹¤ëŠ” Login URLì„ ì „ë‹¬í•´ì„œ ë¡œê·¸ì¸ ë°ì´í„°ë¥¼ ì§ì ‘ ì „ë‹¬ë°›ëŠ” ë°©ë²•ë„ ë§ì´ ì‚¬ìš©í•˜ëŠ”ê²ƒìœ¼ë¡œ ì•Œê³  ìˆì§€ë§Œ, ë¡œê·¸ì¸ í™”ë©´ì„ ì§ì ‘ ê°œë°œ í•œ ê²½ìš°ì— ì´ëŸ° APIë¥¼ ì—°ë™ì‹œí‚¤ê±°ë‚˜ Spring Bootì™€ Keycloak Admin Client ë¥¼ ì—°ë™í•´ì„œ ì¸ì¦ì„ ì¤‘ê³„í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ”ê²ƒìœ¼ë¡œ ì•Œê³  ìˆìŠµë‹ˆë‹¤.

ì €ê°™ì€ ê²½ìš°ì—” ì¸ì¦ê³¼ ê´€ë ¨ëœ ìš”ì²­ì€ ëª¨ë‘ Keycloak ì— ìœ„ì„í•˜ë‹¤ì‹œí”¼ í•´ì„œ ê°œë°œí–ˆìŠµë‹ˆë‹¤. ì¸ì¦ì— ëŒ€í•œ ì±…ì„ê³¼ ì¸ê°€(ê¶Œí•œ) ì— ëŒ€í•œ ì±…ì„ì„ ë¶„ë¦¬í•˜ê³  Resource Server ê·¸ ìì²´ì˜ ëª©ì ëŒ€ë¡œ ì‚¬ìš©ë˜ê¸° ìœ„í•´ Spring ì—ì„œëŠ” JWT í† í°ì„ ë¶„ì„í•˜ëŠ” ì½”ë“œ ì™¸ì— ìƒì„±ì—ëŠ” ì „í˜€ ê´€ì—¬í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

ìœ ì €ëŠ” í”„ë¡ íŠ¸ì—”ë“œì—ì„œ Keycloak ì„ í–¥í•´ ë¡œê·¸ì¸ ìš”ì²­ì„ ë³´ë‚´ê²Œ ë˜ê³  Keycloakì´ ì „ë‹¬í•´ ì¤€ í† í° ì •ë³´ë¥¼ í†µí•´ Spring Boot API ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚´ê²Œ ë©ë‹ˆë‹¤. Spring Boot API ì„œë²„ëŠ” í•´ë‹¹ í† í°ì˜ ë°œê¸‰ ê²½ë¡œë¥¼ í™•ì¸í•˜ì—¬ í† í°ì´ ìœ íš¨í•œ í† í°ì¸ì§€ í™•ì¸í•˜ê²Œ ë˜ê³  í† í° ë‚´ì˜ ì •ë³´ë¥¼ ë¶„ì„í•˜ì—¬ Role ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ì„œëŠ” Token ì»¤ìŠ¤í„°ë§ˆì´ì§• ë²•ê³¼ Spring Boot API ì„œë²„ ì…‹íŒ… ë²•ì— ëŒ€í•´ ì´ì•¼ê¸° í•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

[](https://www.keycloak.org/documentation)

ì¢€ ë” ìì„¸í•œ ì •ë³´ëŠ” í‚¤í´ë¡ ê³µì‹ ë¬¸ì„œì— ìƒì„¸íˆ ì„¤ëª… ë˜ì–´ ìˆìŠµë‹ˆë‹¤. OpenId connect APIë¥¼ í™œìš©í•œ ì˜ˆì‹œëŠ” ì•„ë˜ ë§í¬ì— ìì„¸íˆ ë‚˜ì™€ìˆìŠµë‹ˆë‹¤.

[](https://www.keycloak.org/docs/latest/securing_apps/#other-openid-connect-libraries)
