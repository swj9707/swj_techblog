---
title: '[ì•Œê³ ì“°ì] Spring - 07 : Auto Configuration'
date: '2025-04-11'
lastmod: '2025-04-11'
tags: ['Spring', 'Backend', 'Study']
draft: false
layout: PostBanner
images: ['https://download.logo.wine/logo/Spring_Framework/Spring_Framework-Logo.wine.png']
summary: ì•Œê³ ì“°ì ì‹œë¦¬ì¦ˆ. Spring AutoConfiguration ì— ëŒ€í•´ ì•Œê³  ì¨ë³´ì!
---

# ğŸƒ Intro

ë‹¤ì‹œ ëŒì•„ì™”ìŠµë‹ˆë‹¤. ì—¬ì „íˆ JSON ì„ ìƒí•˜ì°¨í•˜ë©°, ë•Œë¡œëŠ” JS ë¥¼ ìƒí•˜ì°¨ ì¤‘ì¸ ì†Œí”„íŠ¸ì›¨ì–´ ì¡ë¶€ ì†ìš°ì§„ì…ë‹ˆë‹¤. ì´ë²ˆ ì‹œë¦¬ì¦ˆì˜ ì£¼ì œëŠ” Auto Configuration ì…ë‹ˆë‹¤.  
Spring ì—ì„œ Auto Configuration ê¸°ëŠ¥ì€ ì •ë§ ê°•ë ¥í•©ë‹ˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì„ ì¢€ ë” í¸ë¦¬í•˜ê²Œ ë§Œë“¤ì–´ì£¼ì£ . 
ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” Auto Configuration ì˜ ê°œë…, ë™ì‘ì›ë¦¬, ì»¤ìŠ¤í…€ Auto Configuration ì„ ì‘ì„±í•˜ëŠ” ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤. 

> ì‹œë¦¬ì¦ˆê°€ ì˜¤ë˜ ì§€ì†ë˜ë‹¤ë³´ë‹ˆ ìŠ¬ ì„œë¡  ì“°ëŠ” ê²Œ í˜ë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤ í•˜í•˜...

# âš™ï¸ Configuration?

Auto Configuration ì— ëŒ€í•´ ì´ì•¼ê¸° í•´ ë³´ê¸° ì „ì— Configuration ê·¸ ìì²´ì— ëŒ€í•´ í•œë²ˆ ìƒê°í•´ë³¼ê¹Œ í•©ë‹ˆë‹¤.  
ì• í”Œë¦¬ì¼€ì´ì…˜ì—ëŠ” ì—¬ëŸ¬ê°€ì§€ ì„¤ì • ê°’ ë“¤ì´ í•„ìš”í•˜ì£ . JDBC ì»¤ë„¥ì…˜ì€ ê·¸ëƒ¥ ë§ºì–´ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤. DB ì˜ ì£¼ì†Œ, ê·¸ë¦¬ê³  ê³„ì • ì •ë³´ê°€ ìˆì–´ì•¼ì£ . 

```kotlin
@Configuration
class CustomCacheConfiguration {

    @Bean
    fun cacheManager(): CacheManager {
        println("Custom CacheManager Configured")
        return ConcurrentMapCacheManager("custom")
    }
}

@RestController
@RequestMapping("/cache")
class CacheController(private val cacheManager: CacheManager) {

    @GetMapping("/get")
    fun getCache(): String {
        val cache = cacheManager.getCache("custom")
        cache?.put("key", "value")
        return cache?.get("key")?.get()?.toString() ?: "Cache not found"
    }
}
```

Spring ì—ì„œëŠ” ê°œë°œìê°€ @Bean ê°ì²´ë¡œ ë“±ë¡í•œ ì„¤ì • ê°’ ë“¤ì„ ìš°ë¦¬ëŠ” DI ë¥¼ í†µí•´ ë°›ì•„ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

ì´ëŸ° ë°©ë²•ë“¤ì€ ê°„í¸í•˜ì§€ë§Œ, ë•Œë¡œëŠ” ê°œë°œìë“¤ì˜ ê³µìˆ˜ë¥¼ ëŠ˜ë¦½ë‹ˆë‹¤. @Configuration ë“¤ì„ í†µí•´ ë¬´ì–¸ê°€ ì„¤ì •í•˜ê¸° ì‹œì‘í•˜ë©´, ê´€ë ¨ ëœ ì½”ë“œë“¤ì´ ëŠ˜ì–´ë‚˜ê³ , ê´€ë¦¬ ê³µìˆ˜ê°€ ëŠ˜ì–´ë‚˜ì£ . 

Spring Boot ëŠ” ì´ëŸ° ë¬¸ì œë¥¼ AutoConfiguration ì„ í†µí•´ í•´ê²°í•©ë‹ˆë‹¤. 

> ì •ë§ Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì„±í•˜ê³  ìˆëŠ” ëª¨ë“  ì„¤ì •ê°’ë“¤ì„ ì €ë ‡ê²Œ êµ¬ì„±í•œë‹¤ë©´ ì–¼ë§ˆë‚˜ ë§ì€ ì½”ë“œë“¤ì´ ìƒê¸¸ê¹Œìš”...ì „ë¶€ ìš°ë¦¬ ê´€ë¦¬ ì˜ì—­ì— ë“¤ì–´ì˜¨ë‹¤ê³  ìƒê° í•´ ë³´ë©´ ë§ì€ ìƒê°ë“¤ì´ ë“­ë‹ˆë‹¤...

# ğŸš€ Auto Configuration ê°œìš”

AutoConfigurationì€ Spring Bootì—ì„œ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ, Spring ì»¨í…ìŠ¤íŠ¸ê°€ ì´ˆê¸°í™”ë˜ëŠ” ë™ì•ˆ í•„ìš”í•œ Beanë“¤ì„ ìë™ìœ¼ë¡œ êµ¬ì„±í•˜ê³  ë“±ë¡í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê°œë°œìëŠ” ë³µì¡í•œ ì„¤ì •ì„ ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šê³ ë„ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì£¼ë¡œ `@EnableAutoConfiguration` í˜¹ì€ `@SpringBootApplication` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ í™œì„±í™”ë©ë‹ˆë‹¤. `@SpringBootApplication` ì€ ë‚´ë¶€ì ìœ¼ë¡œ `@EnableAutoConfiguration` ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤. 

```kotlin
@SpringBootApplication
class Application

fun main(args: Array<String>) {
    runApplication<Application>(*args)
}
```

# ğŸ§ Auto Configuration ì˜ ë™ì‘ ì›ë¦¬

## ì•„í‚¤í…ì²˜ êµ¬ì„± ìš”ì†Œ

Spring AutoConfigurationì€ í¬ê²Œ ë‹¤ìŒê³¼ ê°™ì€ ì•„í‚¤í…ì²˜ ìš”ì†Œë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.

- **SpringFactoriesLoader** : ëª¨ë“  AutoConfiguration í´ë˜ìŠ¤ë¥¼ ê²€ìƒ‰í•˜ì—¬ ë“±ë¡í•˜ëŠ” í•µì‹¬ êµ¬ì„± ìš”ì†Œ.
- **ApplicationContext** : AutoConfiguration í´ë˜ìŠ¤ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ëŠ” ì»¨í…Œì´ë„ˆ.
- **Condition Evaluation System** : @Conditional ì–´ë…¸í…Œì´ì…˜ì„ ê¸°ë°˜ìœ¼ë¡œ AutoConfiguration ì ìš© ì—¬ë¶€ë¥¼ ê²°ì •.
- **Environment** : í”„ë¡œí¼í‹° ê°’ ë° Profile ì„¤ì •ì„ ê¸°ë°˜ìœ¼ë¡œ ë¹ˆ ë“±ë¡ì„ ì¡°ì •í•˜ëŠ” ë° ì‚¬ìš©ë¨.

## ë™ì‘ íë¦„

1. `ApplicationContext` ì´ˆê¸°í™” ë‹¨ê³„
    - Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë˜ë©´, SpringApplication.run() ë©”ì„œë“œë¥¼ í†µí•´ `ApplicationContext`ê°€ ìƒì„±ë˜ê³  ì´ˆê¸°í™”ë©ë‹ˆë‹¤.

2. `SpringFactoriesLoader` íƒìƒ‰
    - META-INF/spring.factories íŒŒì¼ì„ ì½ì–´ì„œ ëª¨ë“  `EnableAutoConfiguration` í´ë˜ìŠ¤ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤.
    - ì´ ê³¼ì •ì€ í´ë˜ìŠ¤íŒ¨ìŠ¤ ìƒì— ì¡´ì¬í•˜ëŠ” ëª¨ë“  JAR íŒŒì¼ì„ íƒìƒ‰í•˜ì—¬ spring.factories íŒŒì¼ì„ ì°¾ëŠ” ë°©ì‹ìœ¼ë¡œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

3. `AutoConfiguration` í´ë˜ìŠ¤ ë¡œë”©
    - spring.factories íŒŒì¼ì—ì„œ ì°¾ì€ ëª¨ë“  AutoConfiguration í´ë˜ìŠ¤ë¥¼ ë¡œë”©í•©ë‹ˆë‹¤.
    - ì´ í´ë˜ìŠ¤ë“¤ì€ ì¼ë°˜ì ìœ¼ë¡œ @Configurationìœ¼ë¡œ ì„ ì–¸ë˜ì–´ ìˆìœ¼ë©°, @Conditional ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ í™œì„±í™” ì¡°ê±´ì„ ëª…ì‹œí•©ë‹ˆë‹¤.

4. Condition Evaluation System í‰ê°€
    - ê° AutoConfiguration í´ë˜ìŠ¤ì— ì„ ì–¸ëœ ì¡°ê±´(@Conditional)ì„ í‰ê°€í•©ë‹ˆë‹¤.
    - ì˜ˆë¥¼ ë“¤ì–´, `@ConditionalOnClass`, `@ConditionalOnBean`, `@ConditionalOnProperty` ë“±ì„ ê¸°ë°˜ìœ¼ë¡œ í´ë˜ìŠ¤ì˜ í™œì„±í™” ì—¬ë¶€ë¥¼ ê²°ì •í•©ë‹ˆë‹¤.

5. Bean Definition ë“±ë¡ ë° `ApplicationContext` êµ¬ì„±
    - ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” `AutoConfiguration` í´ë˜ìŠ¤ì˜ ë¹ˆ ì •ì˜(Bean Definition)ë¥¼ `ApplicationContext`ì— ë“±ë¡í•©ë‹ˆë‹¤.
    - ì´í›„ `ApplicationContext`ì˜ refresh() ë©”ì„œë“œë¥¼ í†µí•´ ë¹ˆë“¤ì´ ì´ˆê¸°í™”ë˜ê³ , ì˜ì¡´ì„± ì£¼ì…ì´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

## ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨
```shell
+---------------------+
|  ApplicationContext |
|  (ë¹ˆ ì»¨í…Œì´ë„ˆ)       |
+----------+----------+
           |
           v
+-------------------------+
| SpringFactoriesLoader   |
| (spring.factories íƒìƒ‰) |
+----------+--------------+
           |
           v
+---------------------+
| AutoConfiguration   |
| Class Loading       |
+----------+----------+
           |
           v
+---------------------+
| Condition Evaluation |
| System               |
+----------+----------+
           |
           v
+-----------------------+
| Bean Definition ë“±ë¡  |
| ApplicationContext    |
+-----------------------+
```

## Spring Boot ëŠ” ì™œ ì´ ë°©ì‹ì„ ì±„íƒí–ˆì„ê¹Œìš”?

Spring BootëŠ” ëª¨ë“  **AutoConfiguration** í´ë˜ìŠ¤ë¥¼ í•œ ë²ˆì— ë¡œë“œí•˜ì§€ ì•Šê³ , ì¡°ê±´ì„ í‰ê°€í•˜ì—¬ í•„ìš”í•œ ê²½ìš°ì—ë§Œ ë“±ë¡í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë¶ˆí•„ìš”í•œ ë¹ˆ ë“±ë¡ì„ ë°©ì§€í•˜ê³  ë©”ëª¨ë¦¬ ì‚¬ìš©ì„ ì¤„ì´ë©°, ì´ˆê¸°í™” ì‹œê°„ì„ ë‹¨ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ `@Conditional` ì–´ë…¸í…Œì´ì…˜ì„ í™œìš©í•˜ì—¬ ì»¤ìŠ¤í…€ ì¡°ê±´ì„ ì •ì˜í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— í™•ì¥ì„±ì´ ì¢‹ìŠµë‹ˆë‹¤.  

# ğŸ˜± Auto Configuration ì—†ì´ Configuration ì„¤ì •í•˜ê¸°

AutoConfigurationì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš°, ëª¨ë“  ì„¤ì •ì„ ìˆ˜ë™ìœ¼ë¡œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì•ì„œ ì†Œê°œí–ˆë˜ ê²ƒ ì²˜ëŸ¼ @Bean ê°ì²´ë¥¼ ë“±ë¡í•´ì„œì„œ DataSourceë¥¼ ì„¤ì •í•˜ëŠ” ê²½ìš°ë¥¼ ë¹„êµí•´ ë³´ê² ìŠµë‹ˆë‹¤.

```kotlin
@Configuration
class DataSourceConfig {

    @Bean
    fun dataSource(): DataSource {
        val config = HikariConfig()
        config.jdbcUrl = "jdbc:mysql://localhost:3306/mydb"
        config.username = "root"
        config.password = "password"
        config.driverClassName = "com.mysql.cj.jdbc.Driver"
        return HikariDataSource(config)
    }
}
```

ìœ„ì˜ ì„¤ì • í´ë˜ìŠ¤ëŠ” ìˆ˜ë™ìœ¼ë¡œ DataSourceë¥¼ êµ¬ì„±í•˜ê³  ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ëª¨ë“  ì„¤ì •ì„ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë°˜ë³µ ì‘ì—…ì´ ë§ì´ í•„ìš”í•©ë‹ˆë‹¤.

í•˜ì§€ë§Œ Auto Configuration ì„ ì‚¬ìš©í•œë‹¤ë©´, `application.yml` ì— ì´ë ‡ê²Œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

```yml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/mydb
    username: root
    password: password
    driver-class-name: com.mysql.cj.jdbc.Driver
```

Spring BootëŠ” ìœ„ ì„¤ì •ì„ ê¸°ë°˜ìœ¼ë¡œ ìë™ìœ¼ë¡œ DataSource Beanì„ ë“±ë¡í•©ë‹ˆë‹¤. HikariDataSourceëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ë˜ë©°, ê°œë°œìê°€ ë³„ë„ë¡œ ë“±ë¡í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤. 

# ğŸ¤© Auto Configuration ì‹¤ë¬´ í™œìš© 1 : ì»¨í”½ ìë™ ì„¤ì •

Redis ë¥¼ ì‚¬ìš©í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ RedisTemplate ì„ ìë™ìœ¼ë¡œ ì„¤ì •í•˜ë„ë¡ í•´ ë³´ê² ìŠµë‹ˆë‹¤. 

ë¨¼ì € AutoConfiguration ì—†ì´ Redis Config ì½”ë“œë¥¼ ì‘ì„± í•´ ë³´ê² ìŠµë‹ˆë‹¤. 

```kotlin
// RedisConfig.kt
@Configuration
class RedisConfig {

    @Bean
    fun redisConnectionFactory(): LettuceConnectionFactory {
        return LettuceConnectionFactory(RedisStandaloneConfiguration("localhost", 6379))
    }

    @Bean
    fun redisTemplate(redisConnectionFactory: RedisConnectionFactory): RedisTemplate<String, Any> {
        val template = RedisTemplate<String, Any>()
        template.setConnectionFactory(redisConnectionFactory)
        return template
    }
}
```
ì¼ë°˜ì ìœ¼ë¡œëŠ” ì´ë ‡ê²Œ ë§ì´ ì‘ì„± í•˜ì‹¤ ê²ƒì´ë¼ ìƒê°ì´ ë“¤ì–´ìš”. í•˜ì§€ë§Œ ë‹¨ì ì´ ìˆì£ . ë§¤ë²ˆ Redis ì„¤ì •ì„ ìˆ˜ë™ìœ¼ë¡œ ì‘ì„±í•´ì•¼ í•˜ê³ , ì„¤ì • ë³€ê²½ ì‹œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì— ì˜í–¥ì„ ë¯¸ì¹˜ê¸° ì–´ë µê³  í™˜ê²½ ë³„ ì„¤ì •(dev, prod) ë¥¼ ê´€ë¦¬í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤. 

ë¬¼ë¡  @ProfileActive ì™€ ê°™ì€ ì–´ë…¸í…Œì´ì…˜ì„ ì“¸ ìˆ˜ ìˆê² ì§€ë§Œ, ì—¬ëŸ¬ê°œì˜ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

ê·¸ëŸ¼ Redis ì„¤ì •ì„ ìë™ìœ¼ë¡œ êµ¬ì„±í•˜ëŠ” AutoConfiguration ì„ ì‘ì„± í•´ ë³´ê² ìŠµë‹ˆë‹¤.

```kotlin
// RedisAutoConfiguration.kt
@Configuration
@ConditionalOnClass(RedisTemplate::class)
@AutoConfiguration
@EnableConfigurationProperties(RedisProperties::class)
class RedisAutoConfiguration {

    @Bean
    @ConditionalOnMissingBean(RedisConnectionFactory::class)
    fun redisConnectionFactory(properties: RedisProperties): LettuceConnectionFactory {
        val config = RedisStandaloneConfiguration()
        config.hostName = properties.host ?: "localhost"
        config.port = properties.port ?: 6379
        return LettuceConnectionFactory(config)
    }

    @Bean
    @ConditionalOnMissingBean(RedisTemplate::class)
    fun redisTemplate(redisConnectionFactory: RedisConnectionFactory): RedisTemplate<String, Any> {
        val template = RedisTemplate<String, Any>()
        template.setConnectionFactory(redisConnectionFactory)
        return template
    }
}
```
ì•ì„œ ì›ë¦¬ë¥¼ ì„¤ëª… ë“œë ¸ë“¯ì´ `spring.factories` íŒŒì¼ì„ í†µí•´ Spring Bootê°€ ìë™ìœ¼ë¡œ `RedisAutoConfiguration`ì„ íƒì§€í•©ë‹ˆë‹¤.  
`@ConditionalOnClass(RedisTemplate::class)` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ Redis ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í´ë˜ìŠ¤íŒ¨ìŠ¤ì— ì¡´ì¬í•  ë•Œë§Œ ì„¤ì •ì„ í™œì„±í™”í•©ë‹ˆë‹¤.  
`@ConditionalOnMissingBean` ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì‚¬ìš©ìê°€ ì§ì ‘ ì„¤ì •ì„ ì •ì˜í•˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ ìë™ìœ¼ë¡œ êµ¬ì„±í•©ë‹ˆë‹¤.
```yaml
# application.yml
spring:
  redis:
    host: redis.example.com
    port: 6379
```
```kotlin
// RedisProperties.kt
@ConfigurationProperties(prefix = "spring.redis")
data class RedisProperties(
    var host: String? = null,
    var port: Int? = null
)
```
`RedisProperties` í´ë˜ìŠ¤ëŠ” `application.yml`ì˜ ì„¤ì • ê°’ì„ ì£¼ì…ë°›ì•„ ì‚¬ìš©ë©ë‹ˆë‹¤.
```kotlin
# resources/META-INF/spring.factories
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
com.example.config.RedisAutoConfiguration
```
SpringBoot ëŠ” resource/META-INF ë‚´ì˜ í•´ë‹¹ íŒŒì¼ì„ ì½ì–´ì„œ AutoConfiguration í´ë˜ìŠ¤ë¥¼ íƒìƒ‰í•©ë‹ˆë‹¤. 


ì´ì œ ì´ ê²½ìš° application.yml íŒŒì¼ ë³„ë¡œ í™˜ê²½ ì„¤ì •ì´ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì„¤ì •ì˜ ì¼ê´€ì„±ì„ ë³´ì¥ í•´ ì£¼ë©°, `@ConditionOnMissingBean` ìœ¼ë¡œ ì‚¬ìš©ìê°€ ì§ì ‘ ì„¤ì •ì„ ì •ì˜ í•  ê²½ìš° ìš°ì„  ì ìš©ë˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

# ğŸ¤© Auto Configuration ì‹¤ë¬´ í™œìš© 2 : ì»¤ìŠ¤í…€ Starter ë§Œë“¤ê¸°

ì•„ë§ˆ ë§ì´ë“¤ Spring Boot Starter ë¥¼ ì‚¬ìš© ì¤‘ì´ì‹¤ê²ë‹ˆë‹¤. StarterëŠ” Spring Boot í”„ë¡œì íŠ¸ì—ì„œ íŠ¹ì • ê¸°ëŠ¥ì„ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë¯¸ë¦¬ ì •ì˜ëœ ì„¤ì •ê³¼ ì˜ì¡´ì„±ì„ ì œê³µí•˜ëŠ” ëª¨ë“ˆì…ë‹ˆë‹¤. ì»¤ìŠ¤í…€ Starterë¥¼ ë§Œë“¤ì–´ AutoConfigurationìœ¼ë¡œ ìë™ ì„¤ì •ë˜ë„ë¡ êµ¬ì„±í•˜ëŠ” ì˜ˆì œë¥¼ í•˜ë‚˜ ë³´ì—¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤. 

```shell
my-starter-parent/
â”‚
â”œâ”€â”€ my-starter/
â”‚   â”œâ”€â”€ src/main/kotlin/com/example/mystarter/
â”‚   â”‚   â”œâ”€â”€ MyService.kt
â”‚   â”‚   â”œâ”€â”€ MyServiceAutoConfiguration.kt
â”‚   â”‚   â””â”€â”€ MyStarterProperties.kt
â”‚   â”œâ”€â”€ resources/META-INF/
â”‚   â”‚   â””â”€â”€ spring.factories
â”‚   â”œâ”€â”€ build.gradle.kts
â”‚
â”œâ”€â”€ my-starter-example/
â”‚   â”œâ”€â”€ src/main/kotlin/com/example/demo/
â”‚   â”‚   â””â”€â”€ DemoApplication.kt
â”‚   â”œâ”€â”€ resources/application.yml
â”‚   â”œâ”€â”€ build.gradle.kts
â”‚
â”œâ”€â”€ settings.gradle.kts
â””â”€â”€ build.gradle.kts
```
MyStarter í”„ë¡œì íŠ¸ì˜ êµ¬ì„±ë„ì…ë‹ˆë‹¤. my-starter ëª¨ë“ˆ ë¶€í„° ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. 

```kotlin
plugins {
    kotlin("jvm") version "1.8.10"
    id("org.springframework.boot") version "3.1.8"
    id("io.spring.dependency-management") version "1.1.3"
}

group = "com.example"
version = "0.0.1-SNAPSHOT"

dependencies {
    implementation("org.springframework.boot:spring-boot-autoconfigure")
    implementation("org.jetbrains.kotlin:kotlin-reflect")
    implementation("org.jetbrains.kotlin:kotlin-stdlib-jdk8")
}

java {
    sourceCompatibility = JavaVersion.VERSION_17
    targetCompatibility = JavaVersion.VERSION_17
}
```
my-starter ì˜ build.gradle ì…ë‹ˆë‹¤. SpringBoot autoConfigure íŒ¨í‚¤ì§€ë¥¼ ì°¸ì¡°í•©ë‹ˆë‹¤. 

```kotlin
// MyService.kt
package com.example.mystarter

class MyService(private val message: String) {

    fun printMessage() {
        println("MyService says: $message")
    }
}
```
ê°„ë‹¨í•˜ê²Œ ë©”ì‹œì§€ í•˜ë‚˜ ë„ìš°ëŠ” ë¡œì§ì„ ê°€ì§€ëŠ” í´ë˜ìŠ¤ë¥¼ í•˜ë‚˜ ìƒì„± í•´ ë³´ê² ìŠµë‹ˆë‹¤. ë©”ì‹œì§€ëŠ” í´ë˜ìŠ¤ ìƒì„±ì íŒŒë¼ë¯¸í„°ë¡œ ë°›ê²Œ ë©ë‹ˆë‹¤. 
```kotlin
// MyStarterProperties.kt
package com.example.mystarter

import org.springframework.boot.context.properties.ConfigurationProperties

@ConfigurationProperties(prefix = "mystarter")
data class MyStarterProperties(
    var message: String = "Hello from MyService!"
)
```
Property í´ë˜ìŠ¤ë¥¼ ë³´ê² ìŠµë‹ˆë‹¤. @ConfigurationProperties ì–´ë…¸í…Œì´ì…˜ì„ í†µí•´ ì™¸ë¶€ ì„¤ì •íŒŒì¼ application.yml ë“±ê³¼ ë§¤í•‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„¤ì • ê°’ì˜ ì ‘ë‘ì‚¬ì— ë”°ë¼ í•´ë‹¹ ë©”ì‹œì§€ê°€ ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

```kotlin
// MyServiceAutoConfiguration.kt
package com.example.mystarter

import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean
import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty
import org.springframework.boot.context.properties.EnableConfigurationProperties
import org.springframework.context.annotation.Bean
import org.springframework.context.annotation.Configuration

@Configuration
@EnableConfigurationProperties(MyStarterProperties::class)
@ConditionalOnProperty(prefix = "mystarter", name = ["enabled"], havingValue = "true", matchIfMissing = true)
class MyServiceAutoConfiguration {

    @Bean
    @ConditionalOnMissingBean
    fun myService(properties: MyStarterProperties): MyService {
        return MyService(properties.message)
    }
}
```
Configuration í´ë˜ìŠ¤ë¥¼ ë³´ê² ìŠµë‹ˆë‹¤. MyService í´ë˜ìŠ¤ë¥¼ @Bean ìœ¼ë¡œ ë“±ë¡í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. @EnableConfigurationProperties ë¥¼ í†µí•´ @ConfigurationProperties ë¡œ ì„ ì–¸ ëœ í´ë˜ìŠ¤ë¥¼ í™œì„±í™” í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” MyStarterProperties í´ë˜ìŠ¤ë¥¼ í™œì„±í™”í•˜ì—¬, application.yml ë˜ëŠ” application.properties íŒŒì¼ì˜ ì„¤ì •ì„ ìë™ìœ¼ë¡œ ë°”ì¸ë”©í•©ë‹ˆë‹¤.

@ConditionalOnProperty ë¥¼ í†µí•´ íŠ¹ì • Property ê°’ì— ë”°ë¼ AutoConfiguration ì„ í™œì„±í™” í˜¹ì€ ë¹„í™œì„±í™” í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” mystarter ì˜ enabled ì— ë”°ë¼ ë‹¬ë¼ì§‘ë‹ˆë‹¤. 

```kotlin
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
com.example.mystarter.MyServiceAutoConfiguration
```

ë§ˆì§€ë§‰ìœ¼ë¡œ resource/META-INF ë””ë ‰í† ë¦¬ì— spring.factories íŒŒì¼ì„ ìƒì„±í•´ì„œ AutoConfiguration í´ë˜ìŠ¤ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤. 

ê·¸ëŸ¼ Starter ë¥¼ ì‚¬ìš© í•´ ë´ì•¼ê² ì£ ? my-starter-example ëª¨ë“ˆì—ì„œ Starter ë¥¼ ë¶ˆëŸ¬ì™€ì„œ ì‚¬ìš© í•´ ë³´ê² ìŠµë‹ˆë‹¤. 

```kotlin
plugins {
    kotlin("jvm") version "1.8.10"
    id("org.springframework.boot") version "3.1.8"
    id("io.spring.dependency-management") version "1.1.3"
}

group = "com.example"
version = "0.0.1-SNAPSHOT"

dependencies {
    implementation("org.springframework.boot:spring-boot-starter")
    implementation(project(":my-starter"))
}

java {
    sourceCompatibility = JavaVersion.VERSION_17
    targetCompatibility = JavaVersion.VERSION_17
}
```
ê°™ì€ ëª¨ë“ˆì´ë‹ˆ project(":my-starter") ë¡œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤. 
```kotlin
// DemoApplication.kt
package com.example.demo

import com.example.mystarter.MyService
import org.springframework.boot.autoconfigure.SpringBootApplication
import org.springframework.boot.runApplication
import org.springframework.context.annotation.Bean

@SpringBootApplication
class DemoApplication(
    private val myService: MyService
) {

    @Bean
    fun run() = org.springframework.boot.CommandLineRunner {
        myService.printMessage()
    }
}

fun main(args: Array<String>) {
    runApplication<DemoApplication>(*args)
}
```
```yaml
# application.yml
mystarter:
  enabled: true
  message: "Hello from Custom Starter!"
```
application.yml ì—ëŠ” ì„¤ì • ê°’ë“¤ì„ ì…ë ¥í•˜ê³ , main í´ë˜ìŠ¤ì—ì„œ í•´ë‹¹ Service ë¥¼ DI ë°›ì•„ì„œ ì‚¬ìš© í•©ë‹ˆë‹¤. 
ì•±ì„ ì‹¤í–‰ì‹œí‚¤ë©´ ì•„ë˜ì™€ ê°™ì€ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
```shell
MyService says: Hello from Custom Starter!
```
ì´ì œ ìš°ë¦¬ëŠ” ë”°ë¡œ Bean í´ë˜ìŠ¤ë¥¼ ì„ ì–¸í•˜ì§€ ì•Šê³ ë„ AutoConfiguration ì„ í†µí•´ ìƒì„± ëœ Bean í´ë˜ìŠ¤ë¥¼ DI ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 


# Outro

AutoConfiguration ì— ëŒ€í•´ì„œ ë”¥ë‹¤ì´ë¸Œ ê¹Œì§€ëŠ” ì•„ë‹ˆë”ë¼ë„ ë°œì„ í•œë²ˆ ë‹´ê¶ˆë³´ì•˜ìŠµë‹ˆë‹¤. ìµœê·¼ ë“¤ì–´ì„œ ê´€ë¦¬ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ë“¤ì˜ ëª¨ë“ˆë“¤ì„ ë¶„ë¦¬í•˜ê³  ë¼ì´ë¸ŒëŸ¬ë¦¬í™” í•˜ë ¤ê³  ìƒê° ì¤‘ì´ë¼ ê²¸ì‚¬ê²¸ì‚¬ ì •ë¦¬ í•´ ë³´ì•˜ìŠµë‹ˆë‹¤.  

AutoConfiguration ì„ í†µí•´ ìš°ë¦¬ë§Œì˜ Starter ë“¤ì„ ë§Œë“¤ì–´ ë³´ëŠ” ê²ƒ ì–´ë–¨ê¹Œìš”? ì´ë²ˆ ë‹¬ë„ ìœ ìµí•˜ì…¨ê¸¸ ë°”ëë‹ˆë‹¤.  

ê³§ ë˜ ëµ™ê² ìŠµë‹ˆë‹¤. ğŸ˜Š

# Reference
https://docs.spring.io/spring-boot/reference/using/auto-configuration.html